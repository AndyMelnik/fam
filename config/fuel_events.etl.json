{
  "version": "1.0.0",
  "metadata": {
    "name": "Fuel Events Silver Layer",
    "description": "ETL configuration for building silver layer fuel_events (refuels and drains)",
    "model_name": "hampel_median_ema_delta_cluster_v1",
    "model_version": "1.1.0",
    "created_at": "2025-01-27T00:00:00Z",
    "created_by": "data_platform",
    "tags": ["fuel", "events", "silver_layer", "prod"],
    "owner_team": "data_platform",
    "change_log": [
      {
        "version": "1.0.0",
        "date": "2025-01-27",
        "comment": "Initial configuration for fuel_events"
      }
    ]
  },
  "parameters": {
    "processing_window_hours": 48,
    "detection": {
      "mode": "absolute_and_relative",
      "refuel": {
        "min_step_l": 5.0,
        "min_step_pct_tank": 1.0,
        "min_step_pct_level": 5.0
      },
      "drain": {
        "min_step_l": 5.0,
        "min_step_pct_tank": 1.0,
        "min_step_pct_level": 5.0
      },
      "cluster": {
        "merge_window_min_min": 5,
        "merge_window_min_max": 30,
        "min_points_in_cluster": 1,
        "plateau_window_multiplier": 1.5,
        "stability_threshold_l": 2.0
      },
      "event": {
        "min_volume_l": 10.0,
        "min_volume_pct_tank": 2.0,
        "allow_mixed_sign_cluster": false
      }
    },
    "context": {
      "max_valid_speed_kmh": 5.0,
      "max_hdop": 5.0,
      "use_ignition": true,
      "min_stop_duration_min": 2
    }
  },
  "sql_template": {
    "engine": "postgres",
    "use_transaction": true,
    "timeout_sec": 900,
    "read_only_sources": true,
    "query": " ",
    "parameters": {
      "window_start": ":window_start",
      "window_end": ":window_end",
      "processing_version": "fuel_core_v1.1.0"
    }
  },
  "target": {
    "schema": "silver_data_layer",
    "table": "fuel_events",
    "primary_keys": ["event_id"],
    "partitioning": {
      "type": "time",
      "column": "start_datetime",
      "granularity": "day"
    },
    "indexes": [
      ["device_id", "start_datetime"],
      ["vehicle_id", "start_datetime"],
      ["event_type", "start_datetime"]
    ],
    "retention_policy_days": 365,
    "write_mode": "insert",
    "idempotent": true
  },
  "scheduler": {
    "cron_expression": "5 * * * *",
    "enabled": true,
    "max_runtime_sec": 900,
    "max_concurrent_runs": 1,
    "backfill_allowed": false,
    "catchup_from": null
  },
  "security": {
    "allowed_roles": ["airflow", "data_platform"],
    "source_schemas": ["silver_data_layer"],
    "target_schema": "silver_data_layer",
    "require_tls": true,
    "no_secrets_in_config": true
  }
}
